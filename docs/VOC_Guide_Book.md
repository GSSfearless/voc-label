# VOC数据标注操作手册

## 1. 项目概述

本项目专注于汽车行业VOC（Voice of Customer）数据的智能标注，使用OpenRouter API进行批量处理。项目基于实际生产环境中的标注结果，严格按照统一规范进行实体识别、观点抽取、意图分类和情感分析。

## 2. 标注结果数据结构

### 2.1 完整数据结构

每条标注记录包含以下完整结构：

```json
{
    "text": "原始文本内容",
    "entities": [
        {
            "text": "实体文本",
            "label": "brand|model", 
            "start": 起始位置,
            "end": 结束位置,
            "confidence": 置信度(可选)
        }
    ],
    "aspect_opinions": [
        {
            "aspect": "观点方面",
            "aspect_tag": "一级#二级#三级#四级",
            "opinion": "具体观点表达",
            "sentiment": "positive|negative|neutral",
            "sentiment_score": 情感分数(0.0-1.0)
        }
    ],
    "intent": "意图分类",
    "intent_confidence": 意图置信度(0.0-1.0),
    "sentiment": "整体情感(positive|negative|neutral)",
    "sentiment_score": 整体情感分数(0.0-1.0)
}
```

### 2.2 API配置要求

- **优先使用**: OpenRouter API
- **推荐模型**: `google/gemini-2.5-flash-lite-preview-06-17`
- **并发控制**: 默认10个并发
- **批量大小**: 默认50条

## 3. 实体标注规范

### 3.1 标注范围

**仅标注车辆相关实体**：
- `brand`（品牌）
- `model`（车系/车型）

### 3.2 数据源要求

**品牌标准化**：
- 品牌名称必须严格来源于 `template/get_brand.json` 中的 `name` 字段
- 品牌字段必须一模一样，不能简化或缩写

**车型标准化**：
- 车型名称必须严格来源于 `template/tree_meun.json` 中的 `name` 字段
- 车型字段必须一模一样，不能添加配置信息

**品牌-车型对应关系**：
- 品牌必须是车型的上一级目录（fctitems中的name）
- 确保品牌和车型的层级关系正确

### 3.3 实体格式规范

```json
{
    "text": "实体文本",
    "label": "brand|model", 
    "start": 起始位置(整数),
    "end": 结束位置(整数),
    "confidence": 置信度(0.0-1.0, 可选)
}
```

### 3.4 实体标注示例

**示例1 - 单一车型**：
```json
"entities": [
    {
        "text": "朗逸",
        "label": "model",
        "start": 4,
        "end": 6,
        "confidence": 0.95
    }
]
```

**示例2 - 品牌+车型**：
```json
"entities": [
    {
        "text": "上汽大众",
        "label": "brand",
        "start": 133,
        "end": 137,
        "confidence": 0.95
    },
    {
        "text": "朗逸",
        "label": "model",
        "start": 108,
        "end": 110,
        "confidence": 0.95
    }
]
```

**示例3 - 重复车型识别**：
```json
"entities": [
    {
        "text": "朗逸",
        "label": "model",
        "start": 4,
        "end": 6,
        "confidence": 0.95
    },
    {
        "text": "朗逸",
        "label": "model",
        "start": 91,
        "end": 93,
        "confidence": 0.95
    }
]
```

### 3.5 车型标准化规范

**重要原则**：去除汽车词条相关的配置信息，只保留符合`tree_meun.json`里面跟车型有关的词条（一字不差）

**标准化处理说明**：
- 移除具体配置信息（如：280TSI DSG 豪华版、2022款等）
- 移除年款信息（如：2021款、2022款等）
- 移除具体版本配置（如：舒适版、豪华版、初见版等）
- 严格按照`tree_meun.json`中的`name`字段进行标注

**标准品牌-车型对应示例（必须完全一致）**：

**大众品牌系列**：
- 品牌：`大众` → 厂商：`上汽大众` → 车型：`朗逸`、`途观L`、`ID.4 X`、`ID.6 X`、`大众ID.3`、`Polo`、`帕萨特`、`途昂`、`途岳`
- 品牌：`大众` → 厂商：`一汽-大众` → 车型：`宝来`、`速腾`、`高尔夫`、`迈腾`、`CC`、`探岳`、`揽境`

**岚图品牌系列**：
- 品牌：`岚图汽车` → 厂商：`岚图汽车` → 车型：`岚图追光`、`岚图知音`、`岚图FREE`、`岚图梦想家`

**比亚迪品牌系列**：
- 品牌：`比亚迪` → 厂商：`比亚迪` → 车型：`汉`、`海豚`、`海鸥`、`海豹`、`秦PLUS`、`秦新能源`、`宋PLUS新能源`、`元PLUS`

**重要说明**：
- 车型不包含配置信息：`朗逸` （不是：朗逸 2022款 280TSI DSG 豪华版）
- 车型不包含年款信息：`途观L` （不是：新途观L 330TSI 智动豪华版）
- 车型不包含版本信息：`ID.4 X` （不是：ID4X、ID.4 X 初见版）
- 品牌不能简化：`岚图汽车` （不是：岚图）

**处理原则**：
1. **品牌验证**：品牌名称必须在`get_brand.json`中存在，使用精确的`name`字段值
2. **车型验证**：车型名称必须在`tree_meun.json`中存在，使用精确的`name`字段值
3. **层级关系验证**：确保品牌是车型的上级厂商（fctitems中的name）
4. **字段一致性**：品牌和车型字段必须一模一样，不能简化、缩写或添加信息
5. **复杂描述处理**：从复杂的车型描述中提取标准的核心车型名称
6. **不确定处理**：不确定时分别查询两个JSON文件确认标准名称和对应关系

## 4. 观点抽取规范

### 4.1 基本要求

- **每个观点必须单独成行**
- **观点片段必须在原文中确实存在**
- **aspect_tag必须严格按照四级标签体系**
- **支持多种标签层级格式**

### 4.2 opinion字段提取规范

**连续字段要求**：
- opinion必须来自于原文的连续字符串，不能拼接或重组
- 不能从原文的多个分散位置提取内容组合成opinion
- 必须保持原文的字符顺序和完整性

**长度限制**：
- opinion长度必须控制在**15个字符以内**
- 严格限制，不得超过15个字符
- 优先提取最核心的观点词汇，去除所有冗余表达

**提取原则**：
- 提取最能代表用户观点的核心短语
- 去除无关的修饰词和冗余信息
- 保持观点的完整语义表达
- 符合小模型处理能力要求

### 4.3 四级标签格式

**标准格式**: `一级标签#二级标签#三级标签#四级标签`

**实际应用中的标签示例**：

**完整四级标签**：
```
业务标签#产品体验#智能互联#智能互联功能#手机互联
业务标签#权益服务#售后服务（4S）#服务态度#服务态度
业务标签#产品体验#内饰#内饰部件#其他内饰部件
```

**三级标签**：
```
权益服务#购车权益（4S）#订单权益#权益条款与约定
业务标签#服务体验#服务流程#注册/认证流程
业务标签#产品体验#智能互联#车机系统#车机系统功能
```

### 4.4 观点格式规范

```json
{
    "aspect": "观点方面描述",
    "aspect_tag": "标签路径",
    "opinion": "具体观点表达内容",
    "sentiment": "positive|negative|neutral",
    "sentiment_score": 情感分数(0.0-1.0)
}
```

### 4.5 观点标注示例

**示例1 - 功能问题**：
```json
    {
        "aspect": "CarPlay",
        "aspect_tag": "业务标签#产品体验#智能互联#智能互联功能#手机互联",
    "opinion": "用不了",  // 3个字符，符合15字符限制
    "sentiment": "negative",
    "sentiment_score": 0.9
}
```

**示例2 - 服务问题**：
```json
{
    "aspect": "经销商处理问题",
    "aspect_tag": "业务标签#权益服务#售后服务（4S）#服务态度#服务态度",
    "opinion": "互相推脱",  // 4个字符，符合15字符限制
    "sentiment": "negative",
    "sentiment_score": 0.9
}
```

**示例3 - 权益问题**：
```json
{
    "aspect": "保养券",
    "aspect_tag": "权益服务#购车权益（4S）#订单权益#权益条款与约定",
    "opinion": "看不到",  // 3个字符，更精简
    "sentiment": "negative",
    "sentiment_score": 0.9
}
```

**示例4 - 复杂观点表达（需要精简）**：

**原文**："现在不知道按到什么按键了就出现放音乐连接蓝牙后自动静音了"

**❌ 错误示例（过长，超过15字符）**：
```json
{
    "aspect": "音乐播放",
    "aspect_tag": "业务标签#产品体验#智能互联#娱乐系统#音响效果",
    "opinion": "连接蓝牙后自动静音了",  // 11个字符，但可以更精简
    "sentiment": "negative",
    "sentiment_score": 0.9
}
```

**✅ 正确示例（15字符以内）**：
```json
{
    "aspect": "音乐播放",
    "aspect_tag": "业务标签#产品体验#智能互联#娱乐系统#音响效果",
    "opinion": "自动静音",  // 4个字符，精准表达核心问题
        "sentiment": "negative",
        "sentiment_score": 0.9
}
```

**示例5 - 连续字段要求**：

**原文**："CarPlay用不了，而且系统还很卡顿"

**❌ 错误示例（拼接多处内容）**：
```json
{
    "opinion": "用不了，很卡顿"  // 错误：跳过了中间的"而且系统还"
}
```

**✅ 正确示例（连续字段）**：
```json
    {
    "aspect": "CarPlay",
    "opinion": "用不了",  // 正确：来自原文连续字段，3个字符
        "sentiment": "negative",
        "sentiment_score": 0.9
    }
```

**示例6 - 15字符限制最佳实践**：

**原文示例及正确提取**：

| 原文 | ❌ 错误提取 | ✅ 正确提取 | 字符数 |
|------|-------------|-------------|--------|
| "中控使用中很卡" | "中控使用中很卡" | "很卡" | 2 |
| "没有carlife" | "没有carlife" | "没有" | 2 |
| "打不通店内电话" | "打不通店内电话" | "打不通" | 3 |
| "互相推脱责任" | "互相推脱责任" | "推脱" | 2 |
| "保养券还没到账" | "保养券还没到账" | "没到账" | 3 |
| "需要更换中控车机" | "需要更换中控车机" | "要更换" | 3 |

### 4.6 常见标签分类

**智能互联类**：
- `业务标签#产品体验#智能互联#智能互联功能#手机互联`
- `业务标签#产品体验#智能互联#智能互联功能#车机系统流畅度`
- `业务标签#产品体验#智能互联#娱乐系统#音响效果`
- `业务标签#产品体验#智能互联#APP功能#APP功能`

**服务体验类**：
- `业务标签#权益服务#售后服务（4S）#服务态度#服务态度`
- `业务标签#权益服务#售后服务（4S）#服务效率#服务响应速度`
- `业务标签#服务体验#服务流程#注册/认证流程`
- `业务标签#服务体验#服务流程#问题解决流程`

**权益服务类**：
- `权益服务#购车权益（4S）#订单权益#权益条款与约定`
- `业务标签#权益服务#购车权益（4S）#购车服务体验`
- `业务标签#权益服务#购车权益（4S）#权益条款与约定`

**产品体验类**：
- `业务标签#产品体验#内饰#内饰部件#其他内饰部件`
- `业务标签#产品体验#舒适性#其他效果#车内各种功能操作/调节方便性`

## 5. 意图分类规范

### 5.1 支持的意图类型

支持以下六种意图分类类型：

- **投诉**: 用户对产品或服务的强烈不满
- **抱怨**: 用户表达不满但程度较轻
- **咨询**: 用户询问信息或寻求帮助
- **表扬**: 用户对产品或服务的赞扬和肯定
- **建议**: 用户提出改进建议或优化意见
- **其他**: 无法归类到以上五种类型的其他意图

### 5.2 意图分类标准

**投诉（intent_confidence: 0.90-0.95）**：
- 明确表达强烈不满
- 要求解决具体问题
- 涉及产品缺陷或服务问题
- 语气强烈，情绪激动

**抱怨（intent_confidence: 0.85-0.95）**：
- 表达轻微不满
- 描述遇到的困难
- 希望得到帮助
- 语气相对温和

**咨询（intent_confidence: 0.90-0.95）**：
- 询问具体信息
- 寻求操作指导
- 了解政策规定
- 中性的询问语气

**表扬（intent_confidence: 0.90-0.95）**：
- 对产品或服务表示满意
- 称赞具体功能或体验
- 推荐给他人
- 正面积极的表达

**建议（intent_confidence: 0.85-0.90）**：
- 提出改进意见
- 建议新功能或优化
- 基于使用体验的建设性意见
- 希望产品/服务更好

**其他（intent_confidence: 0.70-0.85）**：
- 无法明确归类的意图
- 混合多种意图类型
- 表达不清晰或模糊
- 非典型的用户反馈

### 5.3 意图标注示例

**投诉示例**：
```json
"intent": "投诉",
"intent_confidence": 0.95
```

**抱怨示例**：
```json
"intent": "抱怨", 
"intent_confidence": 0.85
```

**咨询示例**：
```json
"intent": "咨询",
"intent_confidence": 0.95
```

**表扬示例**：
```json
"intent": "表扬",
"intent_confidence": 0.90
```

**建议示例**：
```json
"intent": "建议",
"intent_confidence": 0.88
```

**其他示例**：
```json
"intent": "其他",
"intent_confidence": 0.75
```

## 6. 情感分析规范

### 6.1 情感类别

- **positive**: 正面情感
- **negative**: 负面情感  
- **neutral**: 中性情感

### 6.2 情感分数标准

**整体情感分数范围**：
- `0.0-0.4`: 强负面情感
- `0.4-0.6`: 中性或轻微负面情感
- `0.6-1.0`: 正面情感

**观点级情感分数**：
- `0.5`: 完全中性
- `0.7-0.8`: 轻微负面
- `0.8-0.9`: 明显负面
- `0.9-1.0`: 强烈负面

### 6.3 情感标注示例

**整体情感**：
```json
"sentiment": "negative",
"sentiment_score": 0.15
```

**观点情感**：
```json
"sentiment": "negative",
"sentiment_score": 0.9
```

## 7. 批处理数据结构

### 7.1 元数据字段

每条记录还包含以下批处理元数据：

```json
{
    "original_index": 0,
    "work_order_id": "ECS20220116195004-20573638788",
    "service_brand": "大众",
    "vehicle_type": "朗逸 2022款 280TSI DSG 豪华版",
    "creation_date": "2022/1/16 19:50",
    "processing_time": "2025-06-19T20:46:01.844327",
    "batch_id": 0
}
```

### 7.2 字段说明

- **original_index**: 原始数据中的索引位置
- **work_order_id**: 系统生成的工单号
- **service_brand**: 服务品牌（大众、奥迪等）
- **vehicle_type**: 完整的车型信息
- **creation_date**: 工单创建日期
- **processing_time**: 标注处理时间戳
- **batch_id**: 批次编号

## 8. 数据处理流程

### 8.1 输入数据准备

1. 使用 `processors/data_cleaner.py` 清理数据
2. 确保文本列为"声音"
3. 过滤无效和空白数据
4. 保留必要的元数据字段

### 8.2 标注处理流程

1. **阶段1**: 实体抽取（品牌、车型识别）
2. **阶段2**: 观点抽取（方面识别、观点提取）
3. **阶段3**: 意图情感分析
4. **阶段4**: 元数据补充和格式标准化

### 8.3 输出格式

- **JSON格式**: 批次处理结果（batch_results/batch_XXXX.json）
- **Excel格式**: 便于查看分析
  - 标注结果工作表
  - 实体详情工作表
  - 观点详情工作表

## 9. 质量控制标准

### 9.1 实体标注质量

- 实体识别准确率 ≥ 95%
- 品牌名称必须来自`get_brand.json`，一字不差
- 车型名称必须来自`tree_meun.json`，一字不差
- 品牌必须是车型的上级厂商（层级关系正确）
- 位置信息准确（start/end）
- 不得使用简化或缩写的品牌名称

### 9.2 观点抽取质量

- 观点片段必须在原文中存在
- aspect_tag必须来自标准标签体系
- 情感分析客观准确
- **opinion字段连续性**：必须来自原文的连续字符串，不能拼接
- **opinion长度控制**：严格限制在15个字符以内，不得超过
- **核心观点提取**：提取最精简的观点词汇，去除所有修饰词
- **小模型优化**：极简表达，确保模型高效处理

### 9.3 意图分类质量

- 意图分类准确率 ≥ 90%
- 置信度设置合理（投诉/咨询/表扬: 0.90-0.95；抱怨/建议: 0.85-0.95；其他: 0.70-0.85）
- 六种意图类型分类标准一致
- 混合意图情况归类为"其他"

## 10. 常见问题与解决方案

### 10.1 实体识别问题

**问题**: 品牌名称不规范或简化
**解决**: 严格使用 `template/get_brand.json` 中的标准品牌名称，如`岚图汽车`而不是`岚图`

**问题**: 车型名称不规范
**解决**: 使用 `template/tree_meun.json` 进行标准化，去除配置和年款信息

**问题**: 品牌-车型层级关系错误
**解决**: 确保品牌是车型的直接上级厂商，查验`tree_meun.json`中的层级结构

**问题**: 同一车型多次出现
**处理**: 分别标注每个出现位置

**问题**: 无法确定品牌-车型对应关系
**解决**: 
1. 先在`get_brand.json`中确认品牌标准名称
2. 再在`tree_meun.json`中找到对应的厂商和车型
3. 验证层级关系：品牌 → 厂商(fctitems) → 车型(seriesitems)

### 10.2 观点抽取问题

**问题**: opinion字段过长
**处理**: 
- 严格控制在15个字符以内
- 提取最核心的观点词汇（通常2-5个字符）
- 去除所有修饰词、背景描述和冗余信息
- 使用最简洁的表达方式

**问题**: opinion字段不连续
**处理**: 
- 不能从原文多个位置拼接内容
- 必须选择原文中的连续字符串
- 如需表达多个观点，分别创建多个观点记录

**问题**: 复杂观点表达
**处理**: 
- 识别核心观点，去除背景描述
- 一个复杂表达可能需要拆分成多个独立观点
- 优先选择最直接的观点表达

**问题**: 标签层级不匹配
**处理**: 使用最匹配的标签路径

**问题**: opinion提取规范不清
**处理**: 
1. 确认opinion来自原文连续字段
2. 检查长度是否符合要求（≤15字符）
3. 验证是否为最精简的核心观点词汇
4. 确保小模型能高效处理（推荐2-5字符）

### 10.3 意图分类问题

**问题**: 意图类型判断困难
**处理**: 按照六种类型的标准特征进行判断，不确定时归类为"其他"

**问题**: 混合多种意图
**处理**: 选择主要意图，或归类为"其他"

**问题**: 表扬与建议区分
**处理**: 表扬侧重肯定现有功能，建议侧重改进优化

### 10.4 情感分析问题

**问题**: 情感倾向模糊
**处理**: 基于具体表达设定合理分数

**问题**: 整体与局部情感冲突
**处理**: 整体情感以主要情感倾向为准

## 11. 文件组织规范

### 11.1 目录结构

```
├── core/                    # 核心标注器
├── processors/             # 数据处理工具
├── template/               # 标注模板和规范
├── logs/                   # 日志文件
├── 平安银联/批量处理结果/   # 批处理结果
│   ├── batch_results/      # JSON批次文件
│   └── processing_*.json   # 处理报告
└── 标注结果/               # 最终输出目录
```

### 11.2 文件命名规范

- **批次文件**: `batch_XXXX.json`
- **处理报告**: `processing_report_YYYYMMDD_HHMMSS.json`
- **最终结果**: `unionpay_complete_results_YYYYMMDD_HHMMSS.json`

## 12. 使用示例

### 12.1 环境准备

```bash
conda activate office-automation
set OPENROUTER_API_KEY=your_api_key
```

### 12.2 批量处理命令

```bash
# 批量处理银联数据
python batch_process_unionpay.py

# 转换为Excel格式
python convert_unionpay_to_excel.py

# 检查处理结果
python check_excel_result.py
```

## 13. 更新历史

- 2025-06-19: 基于实际batch.json数据结构重写操作手册
- 2025-06-20: 补充实际标注示例和质量控制标准
- 2025-06-20: 扩展意图分类从3种到6种（投诉、抱怨、咨询、表扬、建议、其他）
- 2025-06-20: 更新车型标准化规范，要求严格按照tree_meun.json中的name字段标注
- 2025-06-20: 规范品牌-车型数据源：品牌来自get_brand.json，车型来自tree_meun.json，确保层级对应关系
- 2025-06-20: 新增opinion字段提取规范：要求连续字段、长度限制(≤15字符)、极简表达
- 持续更新: 根据生产环境反馈优化标注规范 