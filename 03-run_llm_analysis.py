#!/usr/bin/env python3
"""
ä¹å·ç”µåŠ¨è½¦ç¤¾åª’è¯„è®ºåˆ†æè„šæœ¬
ä¿®æ”¹ä¸‹é¢çš„é…ç½®ï¼Œç„¶åè¿è¡Œï¼špython ninebot.py

æ•°æ®é‡‡æ ·æ–¹å¼ï¼š
1. å…¨éƒ¨æ•°æ®å¤„ç†ï¼šmax_rows=None, random_sample_size=None
2. å‰Nè¡Œå¤„ç†ï¼šmax_rows=1000, random_sample_size=None  
3. éšæœºæŠ½æ ·Nè¡Œï¼šmax_rows=None, random_sample_size=500
4. å¯é‡å¤éšæœºæŠ½æ ·ï¼šè®¾ç½® random_seed=42ï¼ˆå›ºå®šç§å­ç¡®ä¿æ¯æ¬¡æŠ½æ ·ç»“æœç›¸åŒï¼‰

æ•°æ®ç­›é€‰åŠŸèƒ½ï¼ˆæ–°å¢ï¼‰ï¼š
å¯ä»¥æ ¹æ®æŸä¸ªå­—æ®µçš„å€¼æ¥ç­›é€‰éœ€è¦å¤„ç†çš„æ•°æ®ï¼š
1. ç­›é€‰ç‰¹å®šå€¼ï¼šfilter_column="is_processed", filter_values=[0], filter_condition="in"
2. æ’é™¤ç‰¹å®šå€¼ï¼šfilter_column="is_processed", filter_values=[1], filter_condition="not_in"  
3. ç­‰äºæŸå€¼ï¼šfilter_column="status", filter_values=["pending"], filter_condition="equals"
4. ä¸ç­‰äºæŸå€¼ï¼šfilter_column="status", filter_values=["done"], filter_condition="not_equals"

ç¼“å­˜åŠŸèƒ½ï¼ˆèŠ‚çœAPIæˆæœ¬ï¼‰ï¼š
1. æ™ºèƒ½ç¼“å­˜ï¼šç›¸åŒçš„æ–‡æœ¬å†…å®¹ä¼šè‡ªåŠ¨ä½¿ç”¨ç¼“å­˜ç»“æœï¼Œé¿å…é‡å¤çš„APIè°ƒç”¨
2. ç¼“å­˜æ–‡ä»¶ï¼šé»˜è®¤ä¿å­˜åœ¨ data/cache/llm_analysis_cache.json
3. ç¼“å­˜è¿‡æœŸï¼šå¯ä»¥è®¾ç½®ç¼“å­˜çš„æœ‰æ•ˆæœŸï¼Œé»˜è®¤7å¤©
4. æˆæœ¬èŠ‚çœï¼šé‡å¤å¤„ç†æ—¶ä¼šæ˜¾ç¤ºç¼“å­˜å‘½ä¸­ç‡å’ŒèŠ‚çœçš„APIè°ƒç”¨æ¬¡æ•°

ä½¿ç”¨åœºæ™¯ç¤ºä¾‹ï¼š
- åªå¤„ç†æœªå¤„ç†çš„æ•°æ®ï¼šfilter_column="processed", filter_values=[0, "å¦", "N"], filter_condition="in"
- è·³è¿‡å·²å¤„ç†çš„æ•°æ®ï¼šfilter_column="processed", filter_values=[1, "æ˜¯", "Y"], filter_condition="not_in"

æ³¨æ„ï¼š
- random_sample_size ä¼˜å…ˆçº§é«˜äº max_rows
- ç­›é€‰æ¡ä»¶ä¼šåœ¨é‡‡æ ·ä¹‹å‰åº”ç”¨
- è¾“å‡ºæ–‡ä»¶ä¼šä¿ç•™æ‰€æœ‰åŸå§‹æ•°æ®ï¼Œæœªå¤„ç†çš„è¡Œå¯¹åº”å­—æ®µç•™ç©º
- éšæœºæŠ½æ ·é€‚åˆå¤§æ•°æ®é›†çš„å¿«é€Ÿæµ‹è¯•å’ŒéªŒè¯
- è®¾ç½®éšæœºç§å­å¯ä»¥ç¡®ä¿æŠ½æ ·ç»“æœçš„å¯é‡å¤æ€§
- ç¼“å­˜åŸºäºæ–‡æœ¬å†…å®¹çš„å“ˆå¸Œå€¼ï¼Œç¡®ä¿å†…å®¹å®Œå…¨ç›¸åŒæ‰ä¼šå‘½ä¸­ç¼“å­˜
"""

import asyncio
import logging
import os
from dotenv import load_dotenv
from batch_llm_api import APIConfig, ProcessConfig, LLMBatchProcessor

# åŠ è½½ç¯å¢ƒå˜é‡
load_dotenv()

# è®¾ç½®ä¸ºINFOçº§åˆ«ï¼Œé¿å…è¿‡å¤šè°ƒè¯•ä¿¡æ¯
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')

async def main():
    # ========== é…ç½®åŒºåŸŸ ==========
    
    # 1. APIé…ç½® - ä»ç¯å¢ƒå˜é‡è¯»å–APIå¯†é’¥
    api_key = os.getenv("OPENROUTER_API_KEY")
    if not api_key:
        raise ValueError("è¯·è®¾ç½®ç¯å¢ƒå˜é‡ OPENROUTER_API_KEYï¼Œæˆ–åœ¨.envæ–‡ä»¶ä¸­é…ç½®")
    
    api_config = APIConfig(
        api_key=api_key,  # ğŸ”‘ ä»ç¯å¢ƒå˜é‡è¯»å–APIå¯†é’¥
        model="google/gemini-2.5-flash-preview-05-20",                   # ğŸ¤– å¯é€‰çš„æ¨¡å‹
        max_concurrent=60,                        # ğŸš€ å¹¶å‘æ•°ï¼ˆå»ºè®®å…ˆç”¨å°å€¼æµ‹è¯•ï¼‰
        timeout=60,                              # â° è¶…æ—¶æ—¶é—´
        retry_attempts=1,                        # ğŸ”„ é‡è¯•æ¬¡æ•°
        system_prompt="""ä½ æ˜¯ä¸€ä¸ªç”µåŠ¨è½¦è¡Œä¸šåˆ†ç±»ä¸“å®¶ï¼Œä½ éµå¾ªç»™å®šçš„å±‚çº§æ ‡ç­¾ä½“ç³»è¿›è¡Œæ–‡æœ¬åˆ†ç±»ï¼Œå¦‚æœæ— æ³•åˆ¤æ–­ï¼Œè¯·è¿”å›å…¶ä»–ã€‚
        ä»¥ä¸‹æ˜¯å›ºå®šçš„ä¸€å¥—æ ‡ç­¾ä½“ç³»ï¼š
        äº§å“æ”¯æŒ#äº§å“ä½“éªŒ#äº§å“å»ºè®®#äº§å“å»ºè®®
äº§å“æ”¯æŒ#äº§å“ä½“éªŒ#äº§å“ç»­èˆª#äº§å“ç»­èˆª
äº§å“æ”¯æŒ#äº§å“ä½“éªŒ#äº§å“è®¾è®¡#äº§å“è®¾è®¡
äº§å“æ”¯æŒ#äº§å“ä½“éªŒ#éª‘è¡Œä½“éªŒ#éª‘è¡Œä½“éªŒ
äº§å“æ”¯æŒ#äº§å“æ•…éšœ#ç”µæ± ç±»#æ‰ç”µå¿«
äº§å“æ”¯æŒ#äº§å“æ•…éšœ#å¼‚å“ç±»#åˆ¹è½¦å¼‚å“
äº§å“æ”¯æŒ#äº§å“ä½“éªŒ#äº§å“æ€§èƒ½#é€Ÿåº¦
äº§å“æ”¯æŒ#äº§å“æ•…éšœ#å¤–è§‚ç±»#å¤–è§‚ä¸è‰¯
äº§å“æ”¯æŒ#äº§å“æ•…éšœ#å……ç”µç±»#æ— æ³•å……ç”µ
äº§å“æ”¯æŒ#äº§å“æ•…éšœ#æ˜¾ç¤ºç±»#æ˜¾ç¤ºå±æ˜¾ç¤ºå¼‚å¸¸
äº§å“æ”¯æŒ#äº§å“æ•…éšœ#å¤–è§‚ç±»#å¤–è§‚ä»¶æ–­è£‚/è„±è½
äº§å“æ”¯æŒ#APP#è®¾å¤‡é¦–é¡µ#è“ç‰™è¿æ¥
äº§å“æ”¯æŒ#APP#è®¾å¤‡æ•°æ®#éª‘è¡Œè½¨è¿¹
äº§å“æ”¯æŒ#äº§å“ä½“éªŒ#äº§å“æ€§èƒ½#åˆ¹è½¦
äº§å“æ”¯æŒ#äº§å“æ•…éšœ#éª‘è¡Œç±»#éª‘è¡Œæ–­ç”µ
äº§å“æ”¯æŒ#äº§å“å’¨è¯¢#äº§å“ä½¿ç”¨#äº§å“ä½¿ç”¨
äº§å“æ”¯æŒ#äº§å“æ•…éšœ#ç¯ç±»#ç¯å…‰å¼‚å¸¸
äº§å“æ”¯æŒ#äº§å“ä½“éªŒ#äº§å“æ€§èƒ½#å‡éœ‡
äº§å“æ”¯æŒ#APP#æ™ºèƒ½é˜²ç›—#æ™ºèƒ½æœåŠ¡è´¹
äº§å“æ”¯æŒ#äº§å“æ•…éšœ#éª‘è¡Œç±»#éª‘è¡Œæ™ƒåŠ¨/æŠ–åŠ¨
äº§å“æ”¯æŒ#äº§å“æ•…éšœ#å¼‚å“ç±»#å‰/åè½®å¼‚å“
äº§å“æ”¯æŒ#äº§å“å’¨è¯¢#äº§å“æ”¹è£…#äº§å“æ”¹è£…
äº§å“æ”¯æŒ#äº§å“æ•…éšœ#å¼‚å“ç±»#å‡éœ‡å¼‚å“
äº§å“æ”¯æŒ#äº§å“æ•…éšœ#å¼€å…³æœºç±»#æ— æ³•å¼€å…³æœº
äº§å“æ”¯æŒ#APP#è®¾å¤‡æ•°æ®#å‰©ä½™é‡Œç¨‹ï¼ˆç»­èˆªï¼‰
äº§å“æ”¯æŒ#APP#åŠŸèƒ½è®¾ç½®#æ°®æ°”åŠ é€Ÿå¼€å…³
äº§å“æ”¯æŒ#äº§å“æ•…éšœ#æ²¹é—¨/åˆ¹è½¦ç±»#æ²¹é—¨/åˆ¹è½¦å¤±çµ
äº§å“æ”¯æŒ#äº§å“ä½“éªŒ#äº§å“æ€§èƒ½#åŠ é€Ÿ
äº§å“æ”¯æŒ#äº§å“ä½“éªŒ#äº§å“æ€§èƒ½#çˆ¬å¡
äº§å“æ”¯æŒ#APP#è®¾å¤‡æ•°æ®#ç²¾å‡†ç»­èˆª
äº§å“æ”¯æŒ#APP#åŠŸèƒ½è®¾ç½®#æ²¹é—¨è½¬æŠŠ
äº§å“æ”¯æŒ#APP#æ™ºèƒ½é˜²ç›—#å¼‚åŠ¨æŠ¥è­¦
äº§å“æ”¯æŒ#APP#åŠŸèƒ½è®¾ç½®#èƒ½é‡å›æ”¶
äº§å“æ”¯æŒ#äº§å“æ•…éšœ#å¼€å…³æœºç±»#è‡ªåŠ¨å¼€å…³æœº
æœåŠ¡#æ”¿ç­–æ³•è§„#åœ°æ–¹æ”¿ç­–#ä¸Šç‰Œ/ä¸Šè·¯/æºå¸¦/ç¦æ‘©/é™æ‘©
æœåŠ¡#æ”¿ç­–æ³•è§„#ä¸‰åŒ…æ”¿ç­–#ä¿ä¿®æ ‡å‡†
æœåŠ¡#çº¿ä¸‹æœåŠ¡#æœåŠ¡åº—äººå‘˜æŠ•è¯‰#æœåŠ¡æ€åº¦
é”€å”®#çº¿ä¸Šé”€å”®#çº¿ä¸Šé”€å”®é¡µé¢#çº¿ä¸Šé”€å”®é¡µé¢
é”€å”®#çº¿ä¸‹é”€å”®#é”€å”®é—¨åº—#é—¨åº—ä»·æ ¼
é”€å”®#çº¿ä¸‹é”€å”®#é”€å”®é—¨åº—#éæ–°å“/éå®˜æ–¹
é”€å”®#çº¿ä¸Šé”€å”®#çº¿ä¸Šé”€å”®è®¢å•#çº¿ä¸Šé”€å”®è®¢å•
é”€å”®#çº¿ä¸Šé”€å”®#çº¿ä¸Šé”€å”®è®¢å•#é™ä»·
é”€å”®#çº¿ä¸‹é”€å”®#é”€å”®é—¨åº—#é—¨åº—ä¸Šç‰Œ
é”€å”®#çº¿ä¸‹é”€å”®#é”€å”®é—¨åº—#é”€å”®åº—äººå‘˜æŠ•è¯‰
é”€å”®#çº¿ä¸‹é”€å”®#é”€å”®é—¨åº—#æ ¸é”€/äº¤ä»˜
é”€å”®#çº¿ä¸Šé”€å”®#çº¿ä¸Šé”€å”®é€€æ¬¾#çº¿ä¸Šé”€å”®é€€æ¬¾
ç–‘ä¼¼å±æœº#ç–‘ä¼¼å±æœº#åª’ä½“/å¹³å°#å¾®åš/é»‘çŒ«/æŠ–éŸ³/å°çº¢ä¹¦/ç¤¾ç¾¤/è´´å§/æ¶ˆè´¹ä¿
ç–‘ä¼¼å±æœº#ç–‘ä¼¼å±æœº#æ‘”è½¦å®¢è¯‰#è½»å¾®æ“¦ä¼¤æˆ–ç ´çš®
ç–‘ä¼¼å±æœº#ç–‘ä¼¼å±æœº#æ‘”è½¦å®¢è¯‰#å››è‚¢éª¨æŠ˜ç­‰å¯¹äºäººèº«å¥åº·æœ‰é‡å¤§çš„æŸå
è¥é”€#è¥é”€æ´»åŠ¨#æ–°å“å‘å¸ƒ#æ–°å“å‘å¸ƒ

æœ¬å“å“ç‰Œå¸¸è§ä¸º9å·/Segwayï¼Œè½¦å‹å¸¸è§ä¸ºZT3 Proã€Max G2

å¸¸è§ç«å“å“ç‰ŒåŒ…æ‹¬ï¼šNaveeï¼ˆS65Cï¼‰
å°ç±³/xiaomiï¼ˆ4 Pro Maxï¼‰
Kaabo ï¼ˆMantis 10ï¼‰
Dualtronï¼ˆMiniï¼‰
        """,  # ğŸ­ ç³»ç»Ÿæç¤ºè¯
        # ğŸ’¾ ç¼“å­˜é…ç½® - èŠ‚çœAPIè°ƒç”¨æˆæœ¬
        enable_cache=True,                       # ğŸ”§ å¯ç”¨ç¼“å­˜åŠŸèƒ½
        cache_file="data/cache/llm_analysis_cache.json",  # ğŸ“ ç¼“å­˜æ–‡ä»¶è·¯å¾„
        cache_ttl=7*24*3600,                     # â³ ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆ7å¤©ï¼‰ï¼ŒNoneè¡¨ç¤ºæ°¸ä¸è¿‡æœŸ
    )
    
    # 2. å¤„ç†é…ç½®
    process_config = ProcessConfig(
        input_csv="data/processed/å¢ƒå¤–æ±‡æ€»_20250609_sentences.csv",               # ğŸ“ è¾“å…¥æ–‡ä»¶
        output_csv="data/results/å¢ƒå¤–æ±‡æ€»_20250609-cleaned-sentences-results.csv",                # ğŸ“ è¾“å‡ºæ–‡ä»¶
        input_column="sentence_text",                     # ğŸ“ è¦å¤„ç†çš„åˆ—å
        
        # ğŸ“‹ Promptæ¨¡æ¿ - æ ¹æ®æ‚¨çš„éœ€æ±‚ä¿®æ”¹
        prompt_template="""è¯·åˆ†æä»¥ä¸‹æ–‡æœ¬å†…å®¹ä¸­æ¶‰åŠåˆ°çš„åˆ†ç±»ã€è§‚ç‚¹ã€æƒ…æ„Ÿã€æ„å›¾ã€å“ç‰Œã€è½¦å‹ï¼Œå¹¶ä»¥JSONæ ¼å¼è¿”å›ç»“æœã€‚

æ–‡æœ¬å†…å®¹ï¼š{input_text}

åˆ†æè¦æ±‚ï¼š

1. æ–‡æœ¬ä¸­å¯èƒ½æ¶‰åŠå¤šä¸ªæ ‡ç­¾ï¼Œå¤šä¸ªæ ‡ç­¾åˆ†ç±»éƒ½éœ€è¦ç»™å‡ºï¼Œä»¥ç»™å®šçš„æ ‡ç­¾ä½“ç³»ä¸ºå‡†ï¼Œå¦‚æœæ²¡æœ‰åˆé€‚çš„æ ‡ç­¾ï¼Œåˆ™å¯ä»¥æŒ‰ç…§æ ‡ç­¾æ¡†æ¶ç”Ÿæˆåˆé€‚æ ‡ç­¾ï¼Œä½†æ˜¯æ ‡è®° is_fixed_tag ä¸º False

2. æƒ…æ„Ÿè¿”å›æ­£å‘ã€è´Ÿå‘ã€ä¸­æ€§ï¼Œå¹¶ç»™å‡ºç½®ä¿¡åº¦ï¼Œç½®ä¿¡åº¦èŒƒå›´ä¸º0-1

3. ç”¨æˆ·æ„å›¾è¿”å›å’¨è¯¢ã€æŠ•è¯‰ã€å»ºè®®ã€èµæ‰¬ã€å…¶ä»–ï¼Œä¸èƒ½å¤Ÿå’Œæƒ…æ„Ÿå‘ç”Ÿå†²çª

4. è§‚ç‚¹è¡¨è¾¾åˆ†ä¸ºä¸»ä½“è¯å’Œæè¿°è¯ï¼Œä¸è¦è¿‡é•¿ï¼Œä¸è¦é‡å¤ï¼Œæè¿°è¯ä¸è¦è¶…è¿‡10ä¸ªå­—

5. æ ‡å‡†åŒ–è§„èŒƒåŒ–åçš„è§‚ç‚¹è¡¨è¾¾éœ€è¦èƒ½å¤Ÿä½œä¸ºç‹¬ç«‹æ ‡ç­¾å±•ç¤ºï¼Œå› æ­¤å«ä¹‰è¦æ¸…æ™°

6. è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼Œä¸è¦æœ‰ä»»ä½•å…¶ä»–è§£é‡Šæ–‡å­—ï¼Œ ä»¥ä¸‹æ˜¯ç¤ºä¾‹ï¼š

è¾“å…¥ï¼šæ˜¨å¤©åˆšä¹°çš„M95C ç”µç“¶å……ç”µä¸€ç›´æ˜¯ç»¿ç¯ æœ‰æ²¡æœ‰å¤§ä½¬çŸ¥é“æ€ä¹ˆè§£å†³å•Š
è¾“å‡ºï¼š
[{{
    "sentiment": "è´Ÿå‘",
    "confidence": 0.8,
    "intent": "å’¨è¯¢",
    "aspect": "ç”µç“¶å……ç”µ",
    "desc": "å……ç”µä¸€ç›´æ˜¯ç»¿ç¯", 
    "normalized_viewpoint": "å’¨è¯¢å……ç”µç»¿ç¯åŸå› ",
    "tag": "äº§å“æ”¯æŒ#äº§å“æ•…éšœ#å……ç”µç±»#å…¶ä»–å……ç”µç±»",
    "is_fixed_tag": true,
    "brand": "ä¹å·",
    "model": "M95C"
}}]
""",
        
        # ğŸ“Š è¦æå–çš„JSONå­—æ®µ
        output_json_fields=["sentiment", "confidence", "intent", "aspect", "desc", "normalized_viewpoint", "tag", "brand", "model", "is_fixed_tag"],
        
        # ğŸ² æ•°æ®é‡‡æ ·é…ç½®ï¼ˆå¯é€‰ï¼‰
        max_rows=None,  # ğŸ”¢ æŒ‰é¡ºåºå–å‰Nè¡Œï¼ŒNoneè¡¨ç¤ºä¸é™åˆ¶
        random_sample_size=None,  # ğŸ¯ éšæœºæŠ½æ ·Nè¡Œè¿›è¡Œå¤„ç†ï¼ŒNoneè¡¨ç¤ºä¸æŠ½æ ·
        random_seed=42,  # ğŸŒ± éšæœºç§å­ï¼Œç¡®ä¿æŠ½æ ·ç»“æœå¯é‡å¤ï¼ˆå¯é€‰ï¼‰
        
        # ğŸ” æ•°æ®ç­›é€‰é…ç½®ï¼ˆæ–°å¢åŠŸèƒ½ï¼‰
        # ç¤ºä¾‹1ï¼šåªå¤„ç†æ ‡è®°ä¸ºéœ€è¦å¤„ç†çš„æ•°æ®
        # filter_column="need_process",  # ğŸ“‹ ç­›é€‰å­—æ®µå
        # filter_values=[1, "æ˜¯", "Y", "yes"],  # ğŸ“ ç­›é€‰å€¼åˆ—è¡¨ï¼ˆåŒ…å«è¿™äº›å€¼çš„è¡Œä¼šè¢«å¤„ç†ï¼‰
        # filter_condition="in",  # ğŸ“ ç­›é€‰æ¡ä»¶
        
        # ç¤ºä¾‹2ï¼šè·³è¿‡å·²ç»å¤„ç†è¿‡çš„æ•°æ®  
        # filter_column="is_processed",
        # filter_values=[1, "å·²å¤„ç†", "done"],
        # filter_condition="not_in",
        
        filter_column="is_valid",  # ğŸ“‹ è®¾ç½®ä¸ºNoneè¡¨ç¤ºä¸ä½¿ç”¨ç­›é€‰ï¼Œå¤„ç†æ‰€æœ‰æ•°æ®
        filter_values=[1],  # ğŸ“ ç­›é€‰å€¼åˆ—è¡¨
        filter_condition="in",  # ğŸ“ ç­›é€‰æ¡ä»¶ï¼š'in'åŒ…å«, 'not_in'ä¸åŒ…å«, 'equals'ç­‰äº, 'not_equals'ä¸ç­‰äº
        
        jsonl_file="llm_results_progress.jsonl",  # ğŸ“ é˜¶æ®µæ€§ä¿å­˜çš„jsonlæ–‡ä»¶
        batch_size=60  # ğŸ”„ æ¯30è¡Œä¿å­˜ä¸€æ¬¡
    )
    
    # ========== æ‰§è¡Œå¤„ç† ==========
    
    print("ğŸš€ å¼€å§‹æ‰¹é‡å¤„ç†...")
    print(f"ğŸ“ è¾“å…¥æ–‡ä»¶: {process_config.input_csv}")
    print(f"ğŸ“ è¾“å‡ºæ–‡ä»¶: {process_config.output_csv}")
    print(f"ğŸ¤– ä½¿ç”¨æ¨¡å‹: {api_config.model}")
    print(f"ğŸ”„ æœ€å¤§å¹¶å‘: {api_config.max_concurrent}")
    
    # æ˜¾ç¤ºç¼“å­˜é…ç½®
    if api_config.enable_cache:
        print(f"ğŸ’¾ ç¼“å­˜åŠŸèƒ½: å·²å¯ç”¨")
        print(f"ğŸ“ ç¼“å­˜æ–‡ä»¶: {api_config.cache_file}")
        if api_config.cache_ttl:
            print(f"â³ ç¼“å­˜æœŸé™: {api_config.cache_ttl//3600//24} å¤©")
        else:
            print(f"â³ ç¼“å­˜æœŸé™: æ°¸ä¸è¿‡æœŸ")
    else:
        print("ğŸ’¾ ç¼“å­˜åŠŸèƒ½: å·²ç¦ç”¨")
    
    # æ˜¾ç¤ºæ•°æ®ç­›é€‰é…ç½®
    if process_config.filter_column:
        print(f"ğŸ” æ•°æ®ç­›é€‰: {process_config.filter_column} {process_config.filter_condition} {process_config.filter_values}")
    else:
        print("ğŸ” æ•°æ®ç­›é€‰: æ— ç­›é€‰ï¼Œå¤„ç†æ‰€æœ‰æ•°æ®")
    
    # æ˜¾ç¤ºæ•°æ®é‡‡æ ·é…ç½®
    if process_config.random_sample_size:
        print(f"ğŸ¯ éšæœºæŠ½æ ·: {process_config.random_sample_size} è¡Œ")
        if process_config.random_seed is not None:
            print(f"ğŸŒ± éšæœºç§å­: {process_config.random_seed}")
    elif process_config.max_rows:
        print(f"ğŸ”¢ é™åˆ¶è¡Œæ•°: å‰ {process_config.max_rows} è¡Œ")
    else:
        print("ğŸ“Š å¤„ç†æ¨¡å¼: å…¨éƒ¨æ•°æ®")
    
    print("-" * 50)
    
    try:
        async with LLMBatchProcessor(api_config, process_config) as processor:
            result_df = await processor.process_batch()
            processor.save_results(result_df)
            
            # æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
            total_rows = len(result_df)
            success_rows = len(result_df[result_df['parsing_success'] == True])
            success_rate = success_rows / total_rows * 100 if total_rows > 0 else 0
            
            print("-" * 50)
            print("âœ… å¤„ç†å®Œæˆï¼")
            print(f"ğŸ“Š æ€»å¤„ç†è¡Œæ•°: {total_rows}")
            print(f"âœ… æˆåŠŸå¤„ç†: {success_rows}")
            print(f"ğŸ“ˆ æˆåŠŸç‡: {success_rate:.1f}%")
            print(f"ğŸ“ ç»“æœå·²ä¿å­˜åˆ°: {process_config.output_csv}")
            print(f"ğŸ“ è¿›åº¦æ–‡ä»¶: {process_config.jsonl_file}")
            
            # æ˜¾ç¤ºå‰å‡ è¡Œç»“æœé¢„è§ˆ
            if len(result_df) > 0:
                print("\nğŸ“‹ ç»“æœé¢„è§ˆ:")
                for field in process_config.output_json_fields:
                    if field in result_df.columns:
                        print(f"  {field}: {result_df[field].dropna().head(3).tolist()}")
            
            # è¯¢é—®æ˜¯å¦æ¸…ç†jsonlæ–‡ä»¶
            print(f"\nğŸ’¡ æç¤º: è¿›åº¦æ–‡ä»¶ {process_config.jsonl_file} å·²å®Œæˆä½¿å‘½")
            print("   æ‚¨å¯ä»¥æ‰‹åŠ¨åˆ é™¤å®ƒï¼Œæˆ–ä¿ç•™ä½œä¸ºå¤‡ä»½")
            print("   å¦‚éœ€é‡æ–°å¤„ç†ï¼Œè¯·å…ˆåˆ é™¤æ­¤æ–‡ä»¶ä»¥é¿å…è·³è¿‡å·²å¤„ç†æ•°æ®")
            
    except Exception as e:
        print(f"âŒ å¤„ç†å¤±è´¥: {e}")
        print("ğŸ’¡ è¯·æ£€æŸ¥:")
        print("  1. APIå¯†é’¥æ˜¯å¦æ­£ç¡®")
        print("  2. è¾“å…¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨")
        print("  3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸")
        print("  4. APIé…é¢æ˜¯å¦å……è¶³")

if __name__ == "__main__":
    print("ğŸ¯ æ‰¹é‡LLM APIè°ƒç”¨è„šæœ¬")
    print("=" * 50)
    
    # # æ£€æŸ¥æ˜¯å¦éœ€è¦ä¿®æ”¹é…ç½®
    # import os
    # if not os.path.exists("test_data.csv"):
    #     print("âš ï¸  æµ‹è¯•æ•°æ®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·å…ˆåˆ›å»ºtest_data.csv")
    #     print("å¯ä»¥ä½¿ç”¨æä¾›çš„test_data.csvä½œä¸ºç¤ºä¾‹")
    #     exit(1)
    
    # print("âš ï¸  è¯·ç¡®ä¿å·²ä¿®æ”¹quick_start.pyä¸­çš„APIå¯†é’¥ï¼")
    # input("æŒ‰å›è½¦é”®ç»§ç»­...")
    
    # è¿è¡Œä¸»ç¨‹åº
    asyncio.run(main()) 